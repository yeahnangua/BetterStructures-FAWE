---
mode: plan
cwd: /Users/txw/IdeaProjects/BetterStructures
task: åœ¨åŒºå—é¢„ç”Ÿæˆæ—¶ç»•è¿‡æ–°å¢çš„ç»“æ„å¯è§æ€§é—¨ç¦ï¼Œæ¢å¤åŸç‰ˆç»“æ„æ”¾ç½®é€»è¾‘
complexity: medium
planning_method: builtin
created_at: 2026-02-06T05:44:05Z
---

# Plan: Pregen Ignore Visibility Gate

ğŸ¯ ä»»åŠ¡æ¦‚è¿°
å½“å‰éœ€æ±‚æ˜¯åœ¨ä¿ç•™ä½ æ–°å¢â€œç»“æ„é™„è¿‘åŒºå—éœ€ç©å®¶å¯è§æ‰å…è®¸æ”¾ç½®â€çš„å‰æä¸‹ï¼Œä¸ºåŒºå—é¢„ç”Ÿæˆæµç¨‹æ·»åŠ è±å…åˆ†æ”¯ã€‚ç›®æ ‡æ˜¯åœ¨æ‰§è¡Œ `/betterstructures pregenerate` æ—¶æ¢å¤æ’ä»¶åŸç‰ˆæ”¾ç½®è·¯å¾„ï¼Œé¿å…ç»“æ„å…¨éƒ¨è¢«é—¨ç¦æ‹¦æˆªï¼ŒåŒæ—¶ä¸å½±å“å¸¸è§„è‡ªç„¶ç”Ÿæˆåœºæ™¯ã€‚

ğŸ“‹ æ‰§è¡Œè®¡åˆ’
1. å®šä½å¹¶ç¡®è®¤â€œç©å®¶å¯è§æ€§é—¨ç¦â€çš„å®é™…æ‰§è¡Œç‚¹ï¼Œä¼˜å…ˆæ£€æŸ¥ `NewChunkLoadEvent` çš„æ‰«æå‰ç½®åˆ¤æ–­ä¸å…¶è°ƒç”¨çš„è¾…åŠ©æ–¹æ³•ï¼›è‹¥è¯¥åˆ¤æ–­å°šæœªå…¥åº“ï¼Œåˆ™å…ˆä»¥å½“å‰åˆ†æ”¯å®ç°ä¸ºå‡†è¡¥å……è½ç‚¹è¯´æ˜ã€‚
2. åœ¨é¢„ç”ŸæˆçŠ¶æ€æ¨¡å‹ä¸Šå»ºç«‹ç¨³å®šæŸ¥è¯¢å…¥å£ï¼Œä¼˜å…ˆå¤ç”¨ `ChunkPregenerator.activePregenerators` çš„ä¸–ç•Œçº§è¿‡æ»¤é€»è¾‘ï¼ŒæŠ½å–ä¸ºå¯å¤ç”¨ helperï¼ˆå¦‚ `isPregenerating(World)`ï¼‰ä»¥é¿å…å„å¤„é‡å¤ stream ä»£ç ã€‚
3. å°†å¯è§æ€§é—¨ç¦å°è£…ä¸ºå•ä¸€åˆ¤å®šå‡½æ•°ï¼ˆä¾‹å¦‚ `passesVisibilityGate(Chunk)`ï¼‰ï¼Œå¹¶åœ¨å…¶å¤–å±‚åŠ å…¥é¢„ç”ŸæˆçŸ­è·¯ï¼šè‹¥å½“å‰ä¸–ç•Œå­˜åœ¨ active pregeneratorï¼Œåˆ™ç›´æ¥è¿”å›å…è®¸ï¼Œè·³è¿‡ä½ æ–°å¢æ¡ä»¶ã€‚
4. ä¿æŒåŸç‰ˆç»“æ„é“¾è·¯ä¸å˜ï¼šä»…ç»•è¿‡â€œå¯è§æ€§é—¨ç¦â€ï¼Œä¸æ”¹å˜ç½‘æ ¼å‘½ä¸­ã€ä¸–ç•Œç™½åå•ã€åŒºå— ready æ ¡éªŒã€ç»“æ„ç±»å‹æ‰«æé¡ºåºä¸ç²˜è´´æ‰§è¡Œæµç¨‹ã€‚
5. è¡¥å……æœ€å°å¯è§‚æµ‹æ€§ï¼šåœ¨ debug/info çº§æ—¥å¿—ä¸­åŒºåˆ†â€œå¸¸è§„é—¨ç¦æ”¾è¡Œ/æ‹¦æˆªâ€ä¸â€œé¢„ç”Ÿæˆè±å…æ”¾è¡Œâ€ï¼Œä¾¿äºåœ¨çº¿æ’æŸ¥â€œä¸ºä½•æ­¤å¤„æ”¾ç½®ç»“æ„â€ã€‚
6. å®Œæˆå›å½’éªŒè¯è„šæœ¬ä¸æ‰‹æµ‹çŸ©é˜µï¼š
   - å¸¸è§„æ¨¡å¼ + æ— ç©å®¶å¯è§ï¼šåº”æ‹¦æˆªï¼ˆéªŒè¯ä½ æ–°å¢æ¡ä»¶ä»ç”Ÿæ•ˆï¼‰ã€‚
   - å¸¸è§„æ¨¡å¼ + ç©å®¶å¯è§ï¼šåº”æ­£å¸¸æ”¾ç½®ã€‚
   - é¢„ç”Ÿæˆè¿›è¡Œä¸­ + æ— ç©å®¶å¯è§ï¼šåº”æ”¾ç½®ï¼ˆéªŒè¯è±å…ç”Ÿæ•ˆï¼‰ã€‚
   - é¢„ç”Ÿæˆç»“æŸ/å–æ¶ˆåï¼šåº”æ¢å¤å¯è§æ€§é—¨ç¦ã€‚
7. æ‰§è¡Œæ„å»ºä¸åŸºç¡€å›å½’ï¼ˆ`./gradlew build`ï¼‰ï¼Œå¹¶é‡ç‚¹ç¡®è®¤å‘½ä»¤é“¾è·¯ `/betterstructures pregenerate` ä¸ `/betterstructures cancelPregenerate` è¡Œä¸ºä¸€è‡´ï¼Œæ— çŠ¶æ€æ®‹ç•™ã€‚

âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹
- å½“å‰ä»“åº“æœªæ£€ç´¢åˆ°æ˜ç¡®â€œç©å®¶å¯è§æ€§é—¨ç¦â€ä»£ç ç‰‡æ®µï¼Œå®æ–½å‰éœ€å…ˆå¯¹ä½ æœ¬åœ°æœªæäº¤æ”¹åŠ¨åšä¸€æ¬¡ç²¾ç¡®å®šä½ï¼Œé¿å…è¯¯æ”¹é”™è¯¯å±‚çº§ã€‚
- `activePregenerators` ä¸ºé™æ€é›†åˆï¼Œè‹¥æœªæ¥å¼•å…¥å¼‚æ­¥è®¿é—®æˆ–è·¨çº¿ç¨‹åˆ¤æ–­ï¼Œéœ€è€ƒè™‘å¹¶å‘å®‰å…¨ä¸å¯è§æ€§ï¼ˆå½“å‰ä¸»çº¿ç¨‹äº‹ä»¶æµé€šå¸¸å¯æ§ï¼‰ã€‚
- é¢„ç”Ÿæˆè±å…èŒƒå›´å»ºè®®é™å®šä¸ºâ€œåŒä¸–ç•Œ + å­˜åœ¨æ´»è·ƒé¢„ç”Ÿæˆä»»åŠ¡â€ï¼Œé¿å…å½±å“å…¶ä»–ä¸–ç•Œçš„æ­£å¸¸é—¨ç¦ç­–ç•¥ã€‚

ğŸ“ å‚è€ƒ
- `src/main/java/com/magmaguy/betterstructures/listeners/NewChunkLoadEvent.java:36`
- `src/main/java/com/magmaguy/betterstructures/listeners/NewChunkLoadEvent.java:61`
- `src/main/java/com/magmaguy/betterstructures/listeners/NewChunkLoadEvent.java:100`
- `src/main/java/com/magmaguy/betterstructures/util/ChunkPregenerator.java:25`
- `src/main/java/com/magmaguy/betterstructures/util/ChunkPregenerator.java:76`
- `src/main/java/com/magmaguy/betterstructures/util/ChunkPregenerator.java:288`
- `src/main/java/com/magmaguy/betterstructures/commands/CancelPregenerateCommand.java:26`
